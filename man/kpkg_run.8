.\" Automatically generated by Pandoc 3.1.3
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "kpkg_run" "8" "" "" ""
.hy
.SH NAME
.PP
kpkg runfile - main package format of kpkg
.SH DESCRIPTION
.PP
kpkg runfiles are the main package format of kpkg.
It is a basic shell script with some variables so kpkg can build the
package.
.SH RUNFILE STRUCTURE
.PP
Runfiles are just named \[lq]run\[rq] inside the package directory.
It is written in (except variables) POSIX sh and doesn\[cq]t support any
other languages.
.PP
An example runfile structure;
.IP
.nf
\f[C]
NAME=\[dq]test-v3\[dq]
VERSION=\[dq]0.0.1\[dq]
RELEASE=\[dq]1\[dq]
EXTRACT=true
SOURCES=\[dq]https://test.file/source/testfile.tar.gz;git::https://github.com/kreatolinux/src::543ee30eda806029fa9ea16a1f9767eda7cab4d1\[dq]
DEPENDS=\[dq]testpackage1 testpackage3 testpackage4\[dq]
DEPENDS_TEST2+=\[dq]testpackage5 testpackage6\[dq]
NO_CHKUPD=\[dq]n\[dq]
REPLACES=\[dq]test-v2\[dq]
BACKUP=\[dq]etc/test-v3/main.conf etc/test/settings.conf\[dq]
OPTDEPENDS=\[dq]optional-dependency: This is a test optional dependency ;; optional-dependency-2: This is a second optional dependency.\[dq]
BUILD_DEPENDS=\[dq]testpackage5 testpackage6 testpackage10\[dq]
SHA256SUM=\[dq]e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\[dq]
SHA512SUM=\[dq]cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e\[dq]
B2SUM=\[dq]786a02f742015903c6c6fd852552d272912f4740e15847618a86e217f71f5419d25e1031afee585313896444934eb04b903a685b1448b755d56f701afe9be2ce\[dq]
DESCRIPTION=\[dq]Test package\[dq]

prepare() {
    tar -xvf testfile.tar.gz
}

build() {
    cd testfile
    echo \[dq]Insert build instructions here\[dq]
}

check() {
    ninja -C build test
}

preupgrade() {
    echo \[dq]run before upgrade\[dq]
}

preinstall() {
    echo \[dq]run before first install\[dq]
}

package() {
    cd testfile
    make install
}

package_test2() {
    cd testfile
    make install_test2
}

postinstall() {
    echo \[dq]Insert postinstall instructions here\[dq]
}

postupgrade() {
    echo \[dq]run after upgrade\[dq]
}

postremove() {
    echo \[dq]Insert postremove instructions here\[dq]
}
\f[R]
.fi
.PP
Now lets break it down.
.SS VARIABLES
.IP \[bu] 2
NAME: Name of your package.
Will show this name on the info command.
.IP \[bu] 2
VERSION: Version of your package.
It will be on the info command and updating it will result in kpkg
upgrading the package.
.IP \[bu] 2
RELEASE: Release of your package.
It will also be on the info command and updating it will result in kpkg
upgrading the package.
.IP \[bu] 2
SOURCES: Source URL\[cq]s of your package.
Can be seperated by \[cq] \[cq] like
\f[V]https://test.url https://test.url2\f[R].
Also supports git URL\[cq]s as shown by the second source.
.IP \[bu] 2
DEPENDS: Dependencies of your package.
Seperated by space.
You can also specify versions for your dependencies such as
\f[V]test<=1.8.1\f[R], \f[V]test=1.8.1\f[R], \f[V]test>=1.8.1\f[R],
\f[V]test<1.8.1\f[R], \f[V]test>1.8.1\f[R].
.IP \[bu] 2
BUILD_DEPENDS: Build dependencies of your package.
Seperated by space.
.IP \[bu] 2
SHA256SUM: sha256sum output of the sources.
Should align with sources.
Can also be seperated by \[cq] \[cq].
Doesnt support git URL\[cq]s yet.
.IP \[bu] 2
SHA512SUM: sha512sum output of the sources.
Should align with sources.
Can also be seperated by \[cq] \[cq].
Doesnt support git URL\[cq]s yet.
.IP \[bu] 2
B2SUM: b2sum output of the sources.
Should align with sources.
Can also be seperated by \[cq] \[cq].
Doesnt support git URL\[cq]s yet.
.IP \[bu] 2
DESCRIPTION: Description of the package.
It will be on the info command.
.SS FUNCTIONS
.IP \[bu] 2
package(): The install function.
.SS OPTIONAL FUNCTIONS AND VARIABLES
.IP \[bu] 2
build(): The main build function.
Only time this doesn\[cq]t need to be used is for things such as binary
packages (eg.
linux-firmware) that doesn\[cq]t need to be built.
.IP \[bu] 2
EPOCH: Only use this when the versioning logic fail for the package.
.IP \[bu] 2
prepare(): Files downloaded from SOURCES are extracted by default.
Use prepare() to prevent this and have custom prepare procedure.
.IP \[bu] 2
check(): Test the package.
.IP \[bu] 2
postinstall(): Post-install function.
Will run after the package is installed.
.IP \[bu] 2
postremove(): Post-remove function.
Will run after the package is removed.
.IP \[bu] 2
package_PACKAGENAME(): Install function of PACKAGENAME.
With this function you can package multiple things in the same runfile.
This may be used for packaging sub-projects easier.
.IP \[bu] 2
preupgrade(): Pre-upgrade function.
Will run before upgrade occurs.
.IP \[bu] 2
postupgrade(): Post-upgrade function.
Will run after upgrade occurs.
.IP \[bu] 2
NO_CHKUPD: Disables autoupdating thru chkupd.
False by default.
This will not prevent chkupd from building the package.
Will be enabled if it is one of these values; \[lq]y, yes, true, 1,
on\[rq]
.IP \[bu] 2
REPLACES: Replaces packages put in the variable.
Seperated by space.
.IP \[bu] 2
OPTDEPENDS: Optional dependencies for the package.
Seperated by `;;' like on the example.
.IP \[bu] 2
CONFLICTS: Specify conflicts to the package.
Seperated by a space like DEPENDS.
.IP \[bu] 2
IS_GROUP: Specify if the package is a group package or not.
False by default.
Will be enabled if it is one of these values; \[lq]y, yes, true, 1,
on\[rq]
.IP \[bu] 2
DEPENDS_PACKAGENAME: Change PACKAGENAME with the package name.
You can add/remove dependencies, depending on the usecase like
\f[V]DEPENDS_PACKAGENAME+=\[dq]packagename\[dq]\f[R],
\f[V]DEPENDS_PACKAGENAME-=\[dq]packagename\[dq]\f[R], and you can set
the dependencies completely with
\f[V]DEPENDS_PACKAGENAME=\[dq]packagename\[dq]\f[R]
.IP \[bu] 2
BACKUP: preserves stuff such as configuration files.
Don\[cq]t put / in the path name (eg.
\f[V]etc/bluetooth/main.conf\f[R] instead of
\f[V]/etc/bluetooth/main.conf\f[R]).
Seperate by space.
.IP \[bu] 2
EXTRACT: Boolean.
Extracts the tarball.
\f[V]true\f[R] by default.
Only disable this if you know what you are doing.
.IP \[bu] 2
preinstall() Pre-install function.
Will run when the package is installed for the first time, not when it
is upgraded.
.SS VARIABLE NAMING
.PP
Runfile variables are case insensitive.
They also support popular variable styles such as camelCase, PascalCase,
kebab-case and snake_case.
.PP
Please keep in mind that functions themselves are NOT case insensitive,
and do not support this flexibility.
.SH AUTHOR
.PP
Written by Kreato.
.SH COPYRIGHT
.PP
kpkg is free software: you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free
Software Foundation, either version 3 of the License, or (at your
option) any later version.
.PP
kpkg is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.
See the GNU General Public License for more details.
.PP
You should have received a copy of the GNU General Public License along
with kpkg.
If not, see <https://www.gnu.org/licenses/>.
