.\" Automatically generated by Pandoc 3.1.3
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "jumpstart_dec" "5" "" "" ""
.hy
.SH NAME
.PP
jumpstart_dec - Main declaration format of Jumpstart
.SH DESCRIPTION
.PP
Jumpstart decfiles are the main declaration format of Jumpstart.
They are basic scripts with specific variables and functions that enable
the user to create Jumpstart units such as services, mounts, and timers.
.SH DECFILE STRUCTURE
.PP
Decfiles are simply named \f[V][UNITNAME].kg\f[R] and must be placed
inside the \f[V]/etc/jumpstart\f[R] directory.
It is using Kongue under the hood, see kongue(5).
.SS Example Decfile
.IP
.nf
\f[C]
name: \[dq]example\[dq]
description: \[dq]Example multi unit with services, mounts, and timers\[dq]
type: \[dq]multi\[dq]
depends:
    - \[dq]network\[dq]
depends main:
    - \[dq]example::data\[dq]
after:
    - \[dq]sound\[dq]
after_main:
    - \[dq]example::cache\[dq]

mount data {
    from \[dq]/dev/nvme0n1p2\[dq]
    to \[dq]/mnt/data\[dq]
    fstype \[dq]ext4\[dq]
    timeout \[dq]10s\[dq]
    chmod 755
}

mount cache {
    from \[dq]tmpfs\[dq]
    to \[dq]/var/cache/example\[dq]
    fstype \[dq]tmpfs\[dq]
    extra_args \[dq]-o size=512M\[dq]
}

service main {
    exec \[dq]/usr/bin/example-daemon --config /etc/example.conf\[dq]
}

service helper {
    exec \[dq]/usr/bin/example-helper\[dq]
}

timer cleanup {
    interval 3600
    service \[dq]example-cleanup\[dq]
    on_missed \[dq]skip\[dq]
}

timer sync {
    interval 86400
    service \[dq]example-sync\[dq]
    on_missed \[dq]run\[dq]
}
\f[R]
.fi
.SH SYNTAX AND LANGUAGE FEATURES
.SS REQUIRED VARIABLES
.IP \[bu] 2
\f[B]description\f[R]: Description of the unit.
.IP \[bu] 2
\f[B]type\f[R]: Type of the unit.
Valid values are:
.RS 2
.IP \[bu] 2
\f[V]simple\f[R]: A basic service that runs a single process.
.IP \[bu] 2
\f[V]oneshot\f[R]: A service that runs once and exits.
.IP \[bu] 2
\f[V]multi\f[R]: A unit containing multiple sub-units (services, mounts,
or timers).
.IP \[bu] 2
\f[V]timer\f[R]: A timer that triggers a service at specified intervals.
.IP \[bu] 2
\f[V]mount\f[R]: A filesystem mount unit.
.RE
.SS DEPENDENCY VARIABLES
.IP \[bu] 2
\f[B]depends\f[R]: Runtime dependencies of your unit.
The unit will start after the specified units have started and will fail
if any dependency is not running.
.RS 2
.IP \[bu] 2
Can also depend on a specific sub-unit using
\f[V]depends: \[dq]unitname::subunitname\[dq]\f[R]
.RE
.IP \[bu] 2
\f[B]depends subunitname\f[R]: Specify dependencies for a specific
sub-unit.
Can be modified using:
.RS 2
.IP \[bu] 2
\f[V]depends subunitname+: \[dq]unitname\[dq]\f[R] to add a dependency
.IP \[bu] 2
\f[V]depends subunitname-: \[dq]unitname\[dq]\f[R] to remove a
dependency
.IP \[bu] 2
\f[V]depends subunitname: \[dq]unitname\[dq]\f[R] to replace
dependencies completely
.RE
.SS ORDERING VARIABLES
.IP \[bu] 2
\f[B]after\f[R]: Start this unit after the specified units have started.
Unlike \f[V]depends\f[R], the unit will not fail if the specified units
are not present or not running.
.IP \[bu] 2
\f[B]after subunitname\f[R]: Specify ordering for a specific sub-unit.
Can be modified using:
.RS 2
.IP \[bu] 2
\f[V]after subunitname+: \[dq]unitname\[dq]\f[R] to add an ordering
.IP \[bu] 2
\f[V]after subunitname-: \[dq]unitname\[dq]\f[R] to remove an ordering
.IP \[bu] 2
\f[V]after subunitname: \[dq]unitname\[dq]\f[R] to replace orderings
completely
.RE
.SS OPTIONAL VARIABLES
.IP \[bu] 2
\f[B]name\f[R]: Name of the unit.
If not specified, defaults to the filename without the \f[V].kg\f[R]
extension.
.SS REQUIRED FUNCTIONS
.PP
The required function depends on the unit \f[V]type\f[R]:
.IP \[bu] 2
\f[B]service\f[R]: Required for \f[V]simple\f[R] and \f[V]oneshot\f[R]
types.
Contains commands to execute when the service starts.
.IP \[bu] 2
\f[B]timer\f[R]: Required for \f[V]timer\f[R] type.
See \f[B]TIMERS\f[R] below.
.IP \[bu] 2
\f[B]mount\f[R]: Required for \f[V]mount\f[R] type.
See \f[B]MOUNTS\f[R] below.
.PP
For \f[V]multi\f[R] type units, at least one named function block is
required (e.g., \f[V]service_name\f[R], \f[V]timer_name\f[R], or
\f[V]mount_name\f[R]).
.SS OPTIONAL FUNCTIONS
.IP \[bu] 2
\f[B]service name\f[R]: Defines a named sub-service for \f[V]multi\f[R]
type units.
Replace \f[V]name\f[R] with the sub-service identifier.
.IP \[bu] 2
\f[B]timer name\f[R]: Defines a named timer for \f[V]multi\f[R] type
units.
Replace \f[V]name\f[R] with the timer identifier.
.IP \[bu] 2
\f[B]mount name\f[R]: Defines a named mount for \f[V]multi\f[R] type
units.
Replace \f[V]name\f[R] with the mount identifier.
.SH SERVICES
.PP
Services are units that run processes.
To create a service, set \f[V]type\f[R] to \f[V]simple\f[R] or
\f[V]oneshot\f[R] and define a \f[V]service\f[R] function block.
.SS SERVICE COMMANDS
.PP
The following commands are available inside \f[V]service\f[R] blocks, in
addition to the default Kongue built-in commands (see kongue(5) for
those):
.IP \[bu] 2
\f[B]exec\f[R]: Execute a command as the service process.
Required.
.SS Example Service
.IP
.nf
\f[C]
description: \[dq]Example daemon\[dq]
type: \[dq]simple\[dq]

service {
    exec \[dq]/usr/bin/example-daemon\[dq]
}
\f[R]
.fi
.SH TIMERS
.PP
Timers are units that trigger services at specified intervals.
To create a timer, set \f[V]type\f[R] to \f[V]timer\f[R] and define a
\f[V]timer\f[R] function block.
.SS TIMER COMMANDS
.PP
The following commands are available inside \f[V]timer\f[R] blocks:
.IP \[bu] 2
\f[B]interval\f[R]: Time between service triggers in seconds.
Required.
.IP \[bu] 2
\f[B]service\f[R]: The service to trigger when the timer fires.
Required.
.IP \[bu] 2
\f[B]on_missed\f[R]: Behavior when a scheduled timer run was missed
(e.g., system was off).
Valid values are:
.RS 2
.IP \[bu] 2
\f[V]skip\f[R]: Skip the missed run and wait for the next interval.
This is the default.
.IP \[bu] 2
\f[V]run\f[R]: Run the service immediately when the timer starts.
.RE
.SS Example Timer
.IP
.nf
\f[C]
description: \[dq]Cleanup temporary files every hour\[dq]
type: \[dq]timer\[dq]

timer {
    interval 3600
    service \[dq]cleanup\[dq]
    on_missed \[dq]skip\[dq]
}
\f[R]
.fi
.SH MOUNTS
.PP
Mounts are units that mount filesystems.
To create a mount, set \f[V]type\f[R] to \f[V]mount\f[R] and define a
\f[V]mount\f[R] function block.
.SS MOUNT COMMANDS
.PP
The following commands are available inside \f[V]mount\f[R] blocks:
.IP \[bu] 2
\f[B]from\f[R]: Source device or path to mount (e.g.,
\f[V]/dev/nvme0n1p1\f[R]).
Required.
.IP \[bu] 2
\f[B]to\f[R]: Target mount point directory.
Required.
.IP \[bu] 2
\f[B]fstype\f[R]: Filesystem type (e.g., \f[V]ext4\f[R],
\f[V]btrfs\f[R], \f[V]tmpfs\f[R]).
Required.
.IP \[bu] 2
\f[B]timeout\f[R]: Maximum time to wait for the mount operation (e.g.,
\f[V]5s\f[R], \f[V]1m\f[R]).
.IP \[bu] 2
\f[B]lazy_unmount\f[R]: When \f[V]true\f[R], perform a lazy unmount on
stop, detaching the filesystem immediately and cleaning up references
later.
Default is \f[V]false\f[R].
.IP \[bu] 2
\f[B]chmod\f[R]: Set permissions on the mount point after mounting
(e.g., \f[V]755\f[R]).
.IP \[bu] 2
\f[B]extra_args\f[R]: Additional arguments to pass to the mount command
(e.g., \f[V]\[dq]-o size=512M\[dq]\f[R]).
.SS Example Mount
.IP
.nf
\f[C]
description: \[dq]Mount data partition\[dq]
type: \[dq]mount\[dq]

mount {
    from \[dq]/dev/nvme0n1p1\[dq]
    to \[dq]/mnt/data\[dq]
    fstype \[dq]ext4\[dq]
    timeout \[dq]5s\[dq]
    chmod 755
}
\f[R]
.fi
.SH AUTHOR
.PP
Written by Kreato.
.SH COPYRIGHT
.PP
jumpstart is free software: you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the
Free Software Foundation, either version 3 of the License, or (at your
option) any later version.
.PP
jumpstart is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.
See the GNU General Public License for more details.
.PP
You should have received a copy of the GNU General Public License along
with jumpstart.
If not, see <https://www.gnu.org/licenses/>.
