.\" Automatically generated by Pandoc 3.1.3
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "kpkg_run" "5" "" "" ""
.hy
.SH NAME
.PP
kpkg runfile - Main package format of kpkg
.SH DESCRIPTION
.PP
kpkg runfiles are the main package format of kpkg.
They are basic scripts with specific variables and functions that enable
kpkg to build packages.
.SH RUNFILE STRUCTURE
.PP
Runfiles are simply named \f[V]run3\f[R] and must be placed inside the
package directory.
It is using Kongue under the hood, see kongue(5).
.SS Example Runfile
.IP
.nf
\f[C]
name: \[dq]test-v3\[dq]
version: \[dq]0.0.1\[dq]
release: \[dq]1\[dq]
sources: 
    - \[dq]https://test.file/source/testfile.tar.gz\[dq]
    - \[dq]git::https://github.com/kreatolinux/src::543ee30eda806029fa9ea16a1f9767eda7cab4d1\[dq]
    - \[dq]https://test.file/sources/v${version.split(\[aq].\[aq])[0:2].join(\[aq].\[aq])}/testfile.tar.gz\[dq]
depends: 
    - \[dq]testpackage1\[dq] 
    - \[dq]testpackage3\[dq] 
    - \[dq]testpackage4\[dq]
depends test2: 
    - \[dq]testpackage5\[dq] 
    - \[dq]testpackage6\[dq]
no_chkupd: false
replaces: 
    - \[dq]test-v2\[dq]
backup: 
    - \[dq]etc/test-v3/main.conf\[dq]
    - \[dq]etc/test/settings.conf\[dq]
opt_depends:
    - \[dq]optional-dependency: This is a test optional dependency\[dq]
    - \[dq]optional-dependency-2: This is a second optional dependency.\[dq]
build_depends: 
    - \[dq]testpackage5\[dq] 
    - \[dq]testpackage6\[dq] 
    - \[dq]testpackage10\[dq]
sha256sum: 
    - \[dq]e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\[dq]
    - \[dq]SKIP\[dq]
    - \[dq]ab37404db60460d548e22546a83fda1eb6061cd8b95e37455149f3baf6c5fd38\[dq]
sha512sum:
    - \[dq]cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e\[dq] 
    - \[dq]SKIP\[dq]  
    - \[dq]fce866720603d30cbefe5c0df9c6bacf70cbdb27caef5bcf15f125901cb23a9681ec9f87410a7d2f763af5a89c2b4e43685196ce3b0674868bf81cb3688e47c8\[dq]
b2sum: 
    - \[dq]786a02f742015903c6c6fd852552d272912f4740e15847618a86e217f71f5419d25e1031afee585313896444934eb04b903a685b1448b755d56f701afe9be2ce\[dq]
    - \[dq]SKIP\[dq] 
    - \[dq]64fed8bce19ef14ed2d8434229dc2ec5307e06205610b1859b81b8090ae5ba7001988de896ff4878a15a7b7334e4a06e5889270b2e755fe130f7c80960e66ba2\[dq]
license:
    - \[dq]GPL-3.0-or-later\[dq]
description: \[dq]Test package\[dq]

func custom_func {
    print \[dq]This is a test custom function\[dq]
}

prepare {
    custom_func # We can run custom functions just like commands
    env TEST=1
    exec tar -xvf testfile.tar.gz
    # Or you can use:
    # macro extract --autocd=true
    # to extract all the archives in sources.
}

build {
    cd testfile
    echo \[dq]Insert build instructions here\[dq]
}

check {
    macro test --ninja
    # exec ninja -C build test
}

preupgrade {
    echo \[dq]run before upgrade\[dq]
}

preinstall {
    echo \[dq]run before first install\[dq]
}

package {
    cd testfile
    macro package --meson
}

package test2 {
    cd testfile
    exec make install_test2 # External commands require exec
}

postinstall {
    echo \[dq]Insert postinstall instructions here\[dq]
}

postupgrade {
    echo \[dq]run after upgrade\[dq]
}

postremove {
    echo \[dq]Insert postremove instructions here\[dq]
}
\f[R]
.fi
.SH SYNTAX AND LANGUAGE FEATURES
.SS BUILTIN COMMANDS
.PP
These are the built-in commands available in the runfile environment in
addition to the default Kongue built-in commands (see kongue(5) for
those):
.IP \[bu] 2
\f[B]macro\f[R]: Use macros specifically made for extracting, building,
packaging, and testing packages.
Supported build systems include cmake, ninja, meson, and GNU Automake.
Usage: \f[V]macro [NAME] [FLAGS]\f[R]
.SS MACROS
.PP
Macros are helper commands that simplify common build operations.
They are invoked using \f[V]macro [NAME] [FLAGS]\f[R].
.SS EXTRACT MACRO
.PP
Extracts all archive files in the current directory.
.PP
Usage: \f[V]macro extract [--autocd=true|false]\f[R]
.PP
Flags: * \f[B]\[en]autocd\f[R]: When \f[V]true\f[R], automatically
changes into the extracted directory if there is exactly one directory
after extraction.
Default is \f[V]false\f[R].
.PP
Supported archive formats: \f[V].tar\f[R], \f[V].gz\f[R],
\f[V].tgz\f[R], \f[V].xz\f[R], \f[V].txz\f[R], \f[V].bz2\f[R],
\f[V].tbz2\f[R], \f[V].zip\f[R]
.PP
Example:
.IP
.nf
\f[C]
prepare {
    macro extract --autocd=true
}
\f[R]
.fi
.PP
This is useful when you need to manually control the extraction process
in the \f[V]prepare\f[R] function instead of relying on automatic
extraction.
.SS REQUIRED VARIABLES
.IP \[bu] 2
\f[B]name\f[R]: Name of your package.
Displayed in info command output.
.IP \[bu] 2
\f[B]version\f[R]: Version of your package.
Displayed in info command output.
Updating this will trigger package upgrade.
.IP \[bu] 2
\f[B]release\f[R]: Release number of your package.
Displayed in info command output.
Updating this will trigger package upgrade.
.IP \[bu] 2
\f[B]description\f[R]: Description of the package.
Displayed in info command output.
.SS REQUIRED FUNCTIONS
.IP \[bu] 2
\f[B]package\f[R]: The installation function that defines how the
package should be installed.
.SS SOURCE AND DEPENDENCY VARIABLES
.IP \[bu] 2
\f[B]sources\f[R]: Source URLs of your package.
Can be specified as a list.
Supports git URLs as shown in the example.
.IP \[bu] 2
\f[B]depends\f[R]: Runtime dependencies of your package.
Supports version specifications like:
.RS 2
.IP \[bu] 2
\f[V]test<=1.8.1\f[R]: Less than or equal to version 1.8.1
.IP \[bu] 2
\f[V]test=1.8.1\f[R]: Exactly version 1.8.1
.IP \[bu] 2
\f[V]test>=1.8.1\f[R]: Greater than or equal to version 1.8.1
.IP \[bu] 2
\f[V]test<1.8.1\f[R]: Less than version 1.8.1
.IP \[bu] 2
\f[V]test>1.8.1\f[R]: Greater than version 1.8.1
.RE
.IP \[bu] 2
\f[B]build_depends\f[R]: Build-time dependencies of your package.
.IP \[bu] 2
\f[B]depends packagename\f[R]: Specify dependencies for a specific
sub-package.
The space-separated syntax is preferred, but the legacy underscore
syntax (\f[V]depends_packagename:\f[R]) is also supported for backward
compatibility.
Can be modified using:
.RS 2
.IP \[bu] 2
\f[V]depends packagename+: \[dq]packagename\[dq]\f[R] to add a
dependency
.IP \[bu] 2
\f[V]depends packagename-: \[dq]packagename\[dq]\f[R] to remove a
dependency
.IP \[bu] 2
\f[V]depends packagename: \[dq]packagename\[dq]\f[R] to replace
dependencies completely
.RE
.SS CHECKSUM VARIABLES
.IP \[bu] 2
\f[B]sha256sum\f[R]: SHA-256 checksums of the sources.
Should align with the sources in order.
.IP \[bu] 2
\f[B]sha512sum\f[R]: SHA-512 checksums of the sources.
Should align with the sources in order.
.IP \[bu] 2
\f[B]b2sum\f[R]: BLAKE2 checksums of the sources.
Should align with the sources in order.
.PP
Do mind that Git repositories don\[cq]t have the checksum ability.
You can use \f[V]SKIP\f[R] for git sources as this value is ignored.
.SS OPTIONAL VARIABLES
.IP \[bu] 2
\f[B]epoch\f[R]: Only use when versioning logic fails for the package.
.IP \[bu] 2
\f[B]no_chkupd\f[R]: Disables auto-updating through chkupd.
Default is \f[V]false\f[R].
.IP \[bu] 2
\f[B]extract\f[R]: Controls whether source archives are automatically
extracted before building.
Default is \f[V]true\f[R].
Set to \f[V]false\f[R] for packages that handle extraction manually or
don\[cq]t need it.
.IP \[bu] 2
\f[B]autocd\f[R]: Controls whether kpkg automatically changes into the
extracted directory after extraction.
Default is \f[V]true\f[R] when \f[V]extract\f[R] is \f[V]true\f[R], and
\f[V]false\f[R] when \f[V]extract\f[R] is \f[V]false\f[R].
When enabled and there is exactly one directory after extraction, kpkg
will automatically \f[V]cd\f[R] into it.
.IP \[bu] 2
\f[B]replaces\f[R]: Specifies packages that this package replaces.
.IP \[bu] 2
\f[B]opt_depends\f[R]: Optional dependencies for the package, with
description after colon.
.IP \[bu] 2
\f[B]conflicts\f[R]: Specifies packages that conflict with this package.
.IP \[bu] 2
\f[B]is_group\f[R]: Indicates if the package is a group package.
Default is \f[V]false\f[R].
.IP \[bu] 2
\f[B]backup\f[R]: Preserves files (such as configuration files) during
upgrades.
Don\[cq]t include leading slash (use \f[V]etc/bluetooth/main.conf\f[R]
instead of \f[V]/etc/bluetooth/main.conf\f[R]).
.IP \[bu] 2
\f[B]license\f[R]: List of SPDX license identifiers for the package
(e.g., \[lq]MIT\[rq], \[lq]GPL-3.0-or-later\[rq], \[lq]Apache-2.0\[rq]).
.SS OPTIONAL FUNCTIONS
.IP \[bu] 2
\f[B]build\f[R]: Main build function.
Only optional for packages that don\[cq]t need to be built (e.g.,
binary-only packages).
.IP \[bu] 2
\f[B]prepare\f[R]: Custom preparation procedure.
Files from sources are extracted by default unless this function is
defined.
.IP \[bu] 2
\f[B]check\f[R]: Function to test the package.
.IP \[bu] 2
\f[B]preinstall\f[R]: Runs when the package is installed for the first
time (not during upgrades).
.IP \[bu] 2
\f[B]postinstall\f[R]: Runs after the package is installed.
.IP \[bu] 2
\f[B]preupgrade\f[R]: Runs before an upgrade occurs.
.IP \[bu] 2
\f[B]postupgrade\f[R]: Runs after an upgrade completes.
.IP \[bu] 2
\f[B]postremove\f[R]: Runs after the package is removed.
.IP \[bu] 2
\f[B]package packagename\f[R]: Installation function for a sub-package.
Allows packaging multiple components in the same runfile.
The space-separated syntax is preferred, but the legacy underscore
syntax (\f[V]package_packagename {}\f[R]) is also supported for backward
compatibility.
.SH AUTHOR
.PP
Written by Kreato.
.SH COPYRIGHT
.PP
kpkg is free software: you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free
Software Foundation, either version 3 of the License, or (at your
option) any later version.
.PP
kpkg is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.
See the GNU General Public License for more details.
.PP
You should have received a copy of the GNU General Public License along
with kpkg.
If not, see <https://www.gnu.org/licenses/>.
